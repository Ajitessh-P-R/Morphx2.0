{% extends "base.html" %}

{% block title %}Home | Amrita Social{% endblock %}
{% block content %}
<div class="feed-header">
    <h2>Campus Feed</h2>
    {% if current_user.is_authenticated %}
        <a href="{{ url_for('create_post') }}" class="btn primary">Create Post</a>
    {% endif %}
    <a></a>
</div>

<div class="feed">
    {% for post in posts %}
    <div class="card post animate-fade">
        <div class="post-header">
            <div class="post-author">
                {% if post.author.avatar_url %}
                    <img class="avatar" src="{{ post.author.avatar_url }}" alt="avatar" />
                {% else %}
                    <span class="avatar placeholder">üë§</span>
                {% endif %}
                <div>
                    <div class="username">
                        {{ post.author.username }}{% if post.author.is_admin %} <span class="badge">Admin</span>{% endif %}
                    </div>
                    <div class="muted tiny">{{ post.created_at.strftime('%b %d, %Y %I:%M %p') }}</div>
                </div>
            </div>
            {% if post.is_deleted %}
                <span class="badge danger">Removed</span>
            {% endif %}
        </div>
        <div class="post-body">
            {% if post.content %}
                <p>{{ post.content }}</p>
            {% endif %}
            {% if post.image_url %}
                <img class="post-image" src="{{ post.image_url }}" alt="post image" />
            {% endif %}
        </div>
        <div class="post-actions">
            {% if current_user.is_authenticated %}
                <button class="btn like-btn" onclick="toggleLike({{ post.id }}, this)">
                    <span>‚ù§Ô∏è</span>
                    <span class="like-count">{{ post.likes|length }}</span>
                </button>
                <form class="inline" method="POST" action="{{ url_for('comment_post', post_id=post.id) }}">
                    <input type="text" name="content" placeholder="Write a comment..." required />
                    <button class="btn subtle" type="submit">Comment</button>
                </form>
            {% else %}
                <div class="muted tiny">Login to like or comment</div>
            {% endif %}
        </div>
        {% if post.comments %}
            <div class="comments">
                {% for c in post.comments|reverse %}
                    {% if not c.is_deleted %}
                    <div class="comment">
                        <strong>{{ c.author.username }}</strong>
                        <span class="muted tiny">{{ c.created_at.strftime('%b %d %I:%M %p') }}</span>
                        <div>{{ c.content }}</div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}
    </div>
    {% else %}
        <div class="empty">No posts yet. Be the first to create!</div>
    {% endfor %}
</div>
{% endblock %}